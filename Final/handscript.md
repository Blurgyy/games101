# handscript

title: 我选择的题目是 2.4.2 用两个三角形渲染世界.

我用这两个三角形渲染了一个冰淇淋, 就像右边的冰淇淋.

这是最终效果截图. 演示视频可以在这里看到.

使用两个三角形渲染的基本思想是:

1. 构造两个能够覆盖整个屏幕的三角形
2. 在片段着色器中直接构建距离场, 用距离场计算法向量场
3. 使用 ray marching 方法逐像素渲染

最终得到距离场描述的场景.

***

我的实现过程是这样.

***

把冰淇淋的甜筒分解为这四种元素.

圆台的距离场可变换到二维求得.

碗形实现为两个平面截断球体的结果.

环和线段的距离场可以简单推导得到.

各元素组合起来得到甜筒.

***

奶油看作两层辐射状排列的锥形拧起来的结果.  ---   锥形之间平滑融合来体现奶油的物理性质.

锥形看做顶部半径为 0 的圆台, 直接使用圆台的距离场函数.   ---    锥形需要有平滑的边缘来体现奶油的形态.

使用对视点的变换来实现绕轴对称的锥形和"拧起来"的效果.

两层奶油实现是这样, 组合得到冰淇淋头部.

***

糖果用小立方体体现, 并且有平滑的边缘.

对物体的旋转通过对视点做旋转的逆变换实现.   ---    这是空中的糖果随时间旋转的部分伪代码.

实现糖果后, 和前面的两部分组合得到冰淇淋形状.

***

着色阶段, 基于这样的观察估计软阴影.

两个距离在 ray marching 中都可以方便地得到.

确定正反比关系后添加系数实现估计软阴影.

效果是这样.

***

对冰淇淋三部分分配不同材质.

用伪代码描述的方式控制材质的颜色和粗糙程度.

材质属性在 ray marching 时动态更新.

这是添加材质后的效果.

组合后是这样.

***

最后设置了环境光照并估计了环境光遮蔽, 添加了反走样.

这是最终效果.

***

这些是我在编写过程中参考的资料. 感谢观看!
